<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Naruto</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #fafafa;
            --sidebar-bg: #ffffff;
            --text-color: #262626;
            --primary-color: #ff5e00;
            --card-bg: #ffffff;
            --border-color: #dbdbdb;
            --green-color: #2ecc71;
            --yellow-color: #f1c40f;
            --danger-color: #ed4956;
            
            /* CORES DE STATUS */
            --stat-chakra: #7f8c8d; 
            --stat-stamina: #27ae60; 
            --stat-dano: #e74c3c;   
            --stat-buff: #3498db;   
        }
        body.dark-mode { --bg-color: #000000; --sidebar-bg: #000000; --text-color: #f5f5f5; --card-bg: #121212; --border-color: #363636; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); color: var(--text-color); height: 100vh; overflow: hidden; }

        /* LOGIN */
        .login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 999; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .login-box { background: white; padding: 30px; border-radius: 10px; width: 100%; max-width: 320px; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        .login-box button { background: var(--primary-color); color: white; border: none; padding: 12px; width: 100%; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 16px; }

        /* LAYOUT */
        #app-container { display: flex; height: 100vh; position: relative; }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 998; opacity: 0; transition: opacity 0.3s; }
        .sidebar-overlay.active { display: block; opacity: 1; }
        .sidebar { width: 250px; background: var(--sidebar-bg); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 20px; overflow-y: auto; flex-shrink: 0; z-index: 999; transition: transform 0.3s ease; }
        .logo { font-size: 24px; font-weight: bold; color: var(--primary-color); margin-bottom: 40px; font-family: 'Segoe UI', sans-serif; letter-spacing: 1px; }
        .sidebar button { background: none; border: none; color: var(--text-color); width: 100%; text-align: left; padding: 12px 15px; cursor: pointer; border-radius: 8px; transition: 0.2s; display: flex; align-items: center; gap: 15px; margin-bottom: 5px; font-size: 1rem; }
        .sidebar button:hover { background-color: rgba(0,0,0,0.05); }
        .sidebar button.active { background-color: rgba(255, 94, 0, 0.1); font-weight: bold; color: var(--primary-color); border-left: 4px solid var(--primary-color); }
        #btn-admin-panel { display: none; color: #ed4956; font-weight: bold; }

        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; width: 100%; }
        header { height: 60px; background: var(--sidebar-bg); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; flex-shrink: 0; z-index: 10; }
        #mobile-menu-btn { display: none; background: none; border: none; font-size: 1.5rem; color: var(--text-color); cursor: pointer; margin-right: 10px; }
        .top-nav { display: flex; gap: 15px; overflow-x: auto; flex: 1; margin-right: 10px; scrollbar-width: none; }
        .top-btn { background: none; border: none; padding: 10px 5px; color: #8e8e8e; cursor: pointer; border-bottom: 2px solid transparent; white-space: nowrap; font-size: 0.9rem; font-weight: 500; }
        .top-btn.active { border-bottom-color: var(--primary-color); color: var(--text-color); font-weight: bold; }

        .user-area { display: flex; align-items: center; gap: 10px; position: relative; }
        .ryos { font-weight: bold; color: #e6b800; background: rgba(230, 184, 0, 0.1); padding: 5px 10px; border-radius: 15px; white-space: nowrap; font-size: 0.8rem; }
        .profile-circle { width: 35px; height: 35px; border-radius: 50%; overflow: hidden; cursor: pointer; border: 1px solid var(--border-color); flex-shrink: 0; }
        .profile-circle img { width: 100%; height: 100%; object-fit: cover; }
        .dropdown-menu { display: none; position: absolute; top: 50px; right: 0; background: var(--card-bg); border: 1px solid var(--border-color); width: 200px; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 5px 0; z-index: 100; }
        .dropdown-menu.show { display: block; }
        .dropdown-item { display: block; padding: 12px 15px; color: var(--text-color); text-decoration: none; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .dropdown-item:hover { background: rgba(0,0,0,0.03); }

        #content-area { padding: 20px; overflow-y: auto; background-color: var(--bg-color); flex: 1; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        /* CARDS E GRIDS */
        .bucket-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: var(--card-bg); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center; cursor: pointer; transition: 0.2s; overflow: hidden; position: relative; }
        .card:hover { transform: translateY(-2px); border-color: var(--primary-color); }
        .card-img-top { width: 100%; height: 120px; object-fit: cover; border-radius: 4px; margin-bottom: 8px; border: 1px solid #eee; }
        
        .buy-btn { background-color: var(--primary-color); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; font-weight: bold; margin-top: 8px; font-size: 1rem; cursor: pointer; }
        .buy-btn:hover { background-color: #e05200; }
        
        /* TAG DE QUANTIDADE (INVENTÁRIO) */
        .qtd-badge { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); }
        .inventory-controls { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 8px; background: rgba(0,0,0,0.03); padding: 5px; border-radius: 20px; }
        .btn-minus { background: var(--danger-color); color: white; border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn-minus:hover { transform: scale(1.1); }

        /* Maestria no Card */
        .maestria-display { display: block; font-size: 0.85rem; color: var(--yellow-color); font-weight: bold; margin-top: 4px; text-shadow: 0 0 1px rgba(0,0,0,0.1); }

        /* NOVO: FILTROS DA LOJA */
        .shop-header { margin-bottom: 20px; background: var(--card-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); }
        .shop-location-select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 1rem; margin-bottom: 10px; background: var(--bg-color); color: var(--text-color); }
        .shop-categories { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .shop-cat-btn { padding: 8px 15px; border: 1px solid var(--border-color); background: var(--bg-color); border-radius: 20px; cursor: pointer; white-space: nowrap; font-weight: 500; color: var(--text-color); transition: 0.2s; }
        .shop-cat-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .shop-cat-btn:hover { opacity: 0.8; }

        /* ELEMENTOS E KEKKEI */
        .powers-wrapper { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
        .elementos-container { flex: 1; min-width: 120px; background: var(--card-bg); border-radius: 10px; border: 1px solid var(--border-color); padding: 10px; text-align: center; }
        .elementos-title { font-size: 0.85rem; font-weight: bold; color: #777; margin-bottom: 8px; text-transform: uppercase; }
        .elementos-list { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        
        .element-icon { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color); padding: 2px; background: #fff; }

        /* MISSÕES */
        .mission-btn-start { background: var(--primary-color); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .mission-btn-collect { background: var(--green-color); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 5px; animation: pulse 1.5s infinite; }
        .mission-btn-wait { background: var(--yellow-color); color: #333; width: 100%; border: none; padding: 10px; border-radius: 5px; font-weight: bold; margin-top: 5px; cursor: not-allowed; }
        .mission-btn-done { background: #ccc; color: #666; width: 100%; border: none; padding: 10px; border-radius: 5px; font-weight: bold; margin-top: 5px; cursor: not-allowed; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* FEED */
        #feed { max-width: 600px; margin: 0 auto; width: 100%; }
        .create-post { background: var(--card-bg); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .create-post textarea { width: 100%; padding: 10px; border: none; outline: none; background: transparent; color: var(--text-color); resize: none; font-size: 1rem; }
        .post-tools { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border-color); padding-top: 10px; margin-top: 10px; }
        .upload-btn { cursor: pointer; color: var(--primary-color); font-size: 0.9rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }
        #imageInput { display: none; }
        #preview-container { margin-top: 10px; display: none; position: relative; width: 100%; text-align: center; background: #000; border-radius: 4px; overflow: hidden; }
        #preview-image { max-width: 100%; max-height: 300px; object-fit: contain; }
        .remove-img { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-post { background: var(--primary-color); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: 600; cursor: pointer; font-size: 0.9rem; }
        
        .post { background: var(--card-bg); border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border-color); position: relative; overflow: visible; }
        .post-header { display: flex; align-items: center; padding: 10px; }
        .user-avatar-post { width: 35px; height: 35px; border-radius: 50%; background: #efefef; margin-right: 10px; overflow: hidden; border: 1px solid var(--border-color); }
        .user-avatar-post img { width: 100%; height: 100%; object-fit: cover; }
        .post-info { display: flex; flex-direction: column; }
        .post-author { font-weight: 600; font-size: 0.95rem; color: var(--text-color); }
        .post-time { font-size: 0.75rem; color: #8e8e8e; }
        .post-menu-container { margin-left: auto; position: relative; }
        .post-options-btn { cursor: pointer; color: var(--text-color); padding: 8px; width: 30px; text-align: center; }
        .post-dropdown { display: none; position: absolute; top: 100%; right: 0; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; width: 140px; }
        .post-dropdown.active { display: block; }
        .post-dropdown-item { padding: 10px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text-color); }
        .post-dropdown-item.danger { color: var(--danger-color); }
        .post-content { padding: 0 10px 10px 10px; line-height: 1.5; white-space: pre-wrap; font-size: 0.95rem; }
        .post-image { width: 100%; height: auto; display: block; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); max-height: 600px; object-fit: cover; }
        .post-actions { display: flex; padding: 10px; gap: 15px; }
        .action-btn { background: none; border: none; cursor: pointer; color: var(--text-color); font-size: 1.5rem; display: flex; align-items: center; gap: 5px; padding: 0; }
        .action-btn.liked { color: var(--danger-color); }
        .edit-textarea { width: 100%; border: 1px solid var(--primary-color); border-radius: 4px; padding: 10px; margin: 10px 0; }

        /* RANKINGS */
        .rankings-wrapper { display: flex; gap: 20px; flex-wrap: wrap; padding-bottom: 20px; }
        .ranking-col { flex: 1 1 300px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 15px; }
        .ranking-col h3 { color: var(--primary-color); text-align: center; margin-bottom: 15px; border-bottom: 2px solid var(--primary-color); font-size: 1.1rem; }
        .ranking-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .ranking-table td { padding: 8px; border-bottom: 1px solid var(--border-color); }

        /* MODAIS */
        .modal-overlay-comment { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .close-modal { position: absolute; top: 10px; left: 15px; font-size: 1.8rem; color: white; cursor: pointer; z-index: 20; text-shadow: 0 0 5px black; }
        .modal-content-card { background: var(--card-bg); padding: 30px; border-radius: 10px; width: 90%; max-width: 350px; text-align: center; position: relative; border: 1px solid var(--border-color); }
        .jutsu-modal-img { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        .jutsu-modal-rank { display: inline-block; background: var(--primary-color); color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-bottom: 10px; }
        .jutsu-modal-price { color: var(--green-color); font-weight: bold; font-size: 1.2rem; border-top: 1px solid var(--border-color); padding-top: 15px; }
        
        .jutsu-stats-row { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .jutsu-stat-tag { padding: 4px 12px; border-radius: 15px; color: white; font-weight: bold; font-size: 0.8rem; }
        .tag-dano { background-color: var(--stat-dano); }
        .tag-chakra { background-color: var(--stat-chakra); }
        .tag-stamina { background-color: var(--stat-stamina); }
        .tag-buff { background-color: var(--stat-buff); }

        .modal-content-profile { background: var(--card-bg); width: 90%; max-width: 800px; max-height: 90vh; border-radius: 15px; overflow-y: auto; position: relative; border: 1px solid var(--border-color); }
        .profile-header { background: linear-gradient(to right, #ff5e00, #ff9100); padding: 40px 20px; text-align: center; color: white; }
        .profile-avatar-large { width: 100px; height: 100px; border-radius: 50%; border: 4px solid white; margin: 0 auto 15px auto; overflow: hidden; background: #fff; }
        .profile-avatar-large img { width: 100%; height: 100%; object-fit: cover; }
        .profile-name { font-size: 1.8rem; font-weight: bold; }
        .profile-char { font-size: 1.1rem; opacity: 0.9; }
        .profile-body { padding: 20px; }
        .profile-stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; margin-bottom: 30px; }
        .stat-card { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 10px; padding: 10px; text-align: center; }
        .stat-value { font-size: 1.2rem; font-weight: bold; color: var(--primary-color); }
        .stat-label { font-size: 0.75rem; color: #777; margin-top: 3px; text-transform: uppercase; font-weight: bold; }
        .stats-divider { grid-column: 1 / -1; font-weight: bold; color: var(--text-color); margin: 20px 0 5px 0; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }

        .modal-content-comment { background: var(--card-bg); width: 90%; max-width: 900px; height: 80vh; border-radius: 4px; display: flex; overflow: hidden; position: relative; }
        .modal-left { flex: 1.5; background: #000; display: flex; align-items: center; justify-content: center; }
        .modal-left img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .modal-right { flex: 1; display: flex; flex-direction: column; background: var(--card-bg); border-left: 1px solid var(--border-color); }
        .comments-list { flex: 1; padding: 15px; overflow-y: auto; }
        .comment-input-area { padding: 15px; border-top: 1px solid var(--border-color); display: flex; gap: 10px; }
        .comment-input-area input { flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 20px; outline: none; }
        .edit-input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 5px; }
        .edit-avatar-preview { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-color); margin: 10px auto; display: block; }

        /* HISTORIA */
        .historia-container { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; max-width: 800px; margin: 0 auto; position: relative; }
        .historia-img-container { width: 100%; height: 300px; background-color: #000; position: relative; }
        .historia-img-container img { width: 100%; height: 100%; object-fit: cover; }
        .historia-divider { height: 4px; background-color: #dbdbdb; border: none; margin: 0; }
        .historia-text-content { padding: 30px; line-height: 1.8; font-size: 1.1rem; color: var(--text-color); white-space: pre-wrap; }
        .btn-edit-historia { position: absolute; bottom: 15px; right: 15px; background: var(--primary-color); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn-edit-historia:hover { background: #e05200; }

        /* FRASES */
        .frase-input-area { background: var(--card-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px; display: flex; gap: 10px; }
        .frase-input-area input { flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; outline: none; }
        .frases-list { display: flex; flex-direction: column; gap: 10px; }
        .frase-item { background: var(--card-bg); padding: 20px; border-bottom: 1px solid #ccc; cursor: pointer; transition: background 0.2s; position: relative; border-radius: 5px; display: flex; justify-content: space-between; align-items: flex-start; }
        .frase-item:hover { background-color: rgba(0,0,0,0.02); }
        .frase-content { font-size: 1.1rem; font-style: italic; color: var(--text-color); flex: 1; padding-right: 30px; }
        .frase-author { font-size: 0.85rem; color: var(--primary-color); font-weight: bold; margin-top: 5px; }
        
        .options-menu-container { margin-left: auto; position: relative; }
        .options-btn { cursor: pointer; color: var(--text-color); padding: 8px; width: 30px; text-align: center; }
        .options-dropdown { display: none; position: absolute; top: 100%; right: 0; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; width: 140px; }
        .options-dropdown.active { display: block; }
        .options-item { padding: 10px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text-color); }
        .options-item.danger { color: var(--danger-color); }

        /* BARRA DE XP */
        .level-container { background: var(--card-bg); padding: 15px; border-radius: 10px; border: 1px solid var(--border-color); margin-bottom: 20px; }
        .level-info { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; color: var(--text-color); }
        .xp-bar-bg { width: 100%; height: 20px; background: #eee; border-radius: 10px; overflow: hidden; position: relative; }
        .xp-bar-fill { height: 100%; background: linear-gradient(90deg, #ff9100, #ff5e00); width: 0%; transition: width 0.5s ease-in-out; }
        .xp-text { position: absolute; width: 100%; text-align: center; top: 0; left: 0; font-size: 0.75rem; color: #333; line-height: 20px; font-weight: bold; text-shadow: 0 0 2px white; }

        /* MOBILE */
        @media (max-width: 768px) {
            #mobile-menu-btn { display: block; }
            .sidebar { position: fixed; top: 0; left: -260px; height: 100%; box-shadow: 2px 0 10px rgba(0,0,0,0.3); transition: left 0.3s ease; }
            .sidebar.mobile-active { left: 0; }
            .main-content { width: 100%; }
            header { padding: 0 10px; }
            #content-area { padding: 10px; }
            .bucket-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
            .profile-stats-grid { grid-template-columns: repeat(2, 1fr); }
            .modal-content-comment { flex-direction: column; height: 100%; width: 100%; border-radius: 0; }
            .modal-left { height: 40%; }
            .modal-content-profile { width: 100%; height: 100%; border-radius: 0; }
            .historia-img-container { height: 200px; }
        }
    </style>
</head>
<body>

    <div id="copyFeedback" style="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:10px 20px; border-radius:20px; z-index:3000; display:none;">Frase copiada!</div>

    <div id="login-screen" class="login-overlay">
        <div class="login-box">
            <h2>RPG Naruto</h2>
            <input type="email" id="emailInput" placeholder="E-mail">
            <input type="password" id="passwordInput" placeholder="Senha">
            <button id="btnLogin">Entrar</button>
            <p style="font-size: 12px; margin-top: 15px; color:#777;">Não possui uma conta? Fale com o administrador.</p>
            <p id="msgError" style="color: red; font-size: 12px; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="app-container" style="display: none;">
        <div class="sidebar-overlay" onclick="toggleMobileMenu()"></div>
        
        <aside class="sidebar">
            <div class="logo"><i class="fa-solid fa-scroll"></i> RPG NARUTO</div>
            <nav>
                <button id="side-btn-dashboard" onclick="showTab('dashboard')" class="active"><i class="fa-solid fa-chart-line"></i> Dashboard</button>
                <button id="side-btn-inventario" onclick="showTab('inventario')"><i class="fa-solid fa-box-open"></i> Inventário</button>
                <button id="side-btn-missoes" onclick="showTab('missoes')"><i class="fa-solid fa-scroll"></i> Missões</button>
                <button id="side-btn-personagens" onclick="showTab('personagens')"><i class="fa-solid fa-users"></i> Personagens</button>
                <button id="side-btn-loja" onclick="showTab('loja')"><i class="fa-solid fa-store"></i> Loja</button>
                <button id="side-btn-rankings" onclick="showTab('rankings')"><i class="fa-solid fa-trophy"></i> Rankings</button>
                <button id="btn-admin-panel" onclick="showTab('admin-panel')"><i class="fa-solid fa-user-shield"></i> Painel Kage</button>
            </nav>
        </aside>

        <main class="main-content">
            <header>
                <button id="mobile-menu-btn" onclick="toggleMobileMenu()"><i class="fa-solid fa-bars"></i></button>
                <nav class="top-nav">
                    <button id="nav-btn-feed" onclick="showTab('feed')" class="top-btn active">Feed</button>
                    <button id="nav-btn-jutsus" onclick="showTab('jutsus')" class="top-btn">Jutsus</button>
                    <button id="nav-btn-ferramentas" onclick="showTab('ferramentas')" class="top-btn">Ferramentas</button>
                    <button id="nav-btn-historia" onclick="showTab('historia')" class="top-btn">História</button>
                    <button id="nav-btn-frases" onclick="showTab('frases')" class="top-btn">Frases</button>
                </nav>
                <div class="user-area">
                    <span class="ryos"><i class="fa-solid fa-coins"></i> <span id="ryos-text">...</span></span>
                    <div class="profile-circle" onclick="toggleMenu()">
                        <img id="header-avatar" src="https://placehold.co/40x40/orange/white?text=N" alt="Avatar">
                    </div>
                    <div id="user-menu" class="dropdown-menu">
                        <div class="user-info" style="padding:10px 15px; font-weight:bold; border-bottom:1px solid var(--border-color);">...</div>
                        <div class="dropdown-item" onclick="openEditProfileModal()"><i class="fa-solid fa-user-pen"></i> Perfil e Personagem</div>
                        <div class="dropdown-item" onclick="openChangePasswordModal()"><i class="fa-solid fa-lock"></i> Alterar Senha</div>
                        <div class="dropdown-item" onclick="renderFeed('saved')"><i class="fa-regular fa-bookmark"></i> Salvos</div>
                        <div class="dropdown-item" onclick="renderFeed('all')"><i class="fa-solid fa-globe"></i> Feed Geral</div>
                        <div class="dropdown-item" onclick="fazerLogout()" style="color:var(--danger-color);"><i class="fa-solid fa-arrow-right-from-bracket"></i> Sair</div>
                    </div>
                </div>
            </header>

            <div id="content-area">
                <div id="feed" class="tab-content active">
                    <div class="create-post">
                        <textarea id="postInput" placeholder="No que você está pensando?" rows="2"></textarea>
                        <div id="preview-container" style="display:none; margin-top:10px; position:relative;">
                            <img id="preview-image" src="" style="max-width:100%; max-height:300px; border-radius:4px;">
                            <button onclick="removeImage()" style="position:absolute; top:5px; right:5px; background:rgba(0,0,0,0.6); color:white; border:none; border-radius:50%; width:25px; height:25px;">×</button>
                        </div>
                        <div class="post-tools">
                            <label for="imageInput" style="cursor:pointer; color:var(--primary-color); font-weight:600; display:flex; align-items:center; gap:5px;">
                                <i class="fa-regular fa-image"></i> Foto/Vídeo
                            </label>
                            <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)" style="display:none;">
                            <button class="btn-post" onclick="publicarPost()">Publicar</button>
                        </div>
                    </div>
                    <div id="feed-container"><p style="text-align:center; color:#777; padding:20px;">Carregando feed...</p></div>
                </div>

                <div id="jutsus" class="tab-content"><h3>Meus Jutsus</h3><div class="bucket-grid" id="meus-jutsus-grid"><p>Carregando...</p></div><hr style="border:0; border-top:1px solid var(--border-color); margin:20px 0;"><h3>Loja de Jutsus</h3><div class="bucket-grid" id="loja-jutsus-grid"><p>Carregando...</p></div></div>
                <div id="ferramentas" class="tab-content"><h3>Loja de Ferramentas</h3><div class="bucket-grid" id="loja-ferramentas-grid"><p>Carregando...</p></div></div>
                
                <div id="loja" class="tab-content">
                      <div class="shop-header">
                        <h3 style="margin-bottom:10px;">Localização Atual</h3>
                        <select id="shop-location" class="shop-location-select" onchange="atualizarFiltroVila()">
                            <option value="Konoha">Vila da Folha (Konoha)</option>
                            <option value="Suna">Vila da Areia (Suna)</option>
                            <option value="Kiri">Vila da Névoa (Kiri)</option>
                            <option value="Kumo">Vila da Nuvem (Kumo)</option>
                            <option value="Iwa">Vila da Pedra (Iwa)</option>
                            <option value="Ame">Vila da Chuva (Ame)</option>
                            <option value="Oto">Vila do Som (Oto)</option>
                            <option value="Kori">Vila do Gelo (Kori)</option>
                        </select>
                        <h3 style="margin:15px 0 10px;">Estabelecimentos</h3>
                        <div class="shop-categories">
                            <button class="shop-cat-btn active" onclick="filtrarLojaPorTipo('mercado', this)">Mercado</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('comida', this)">Restaurantes</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('remedio', this)">Hospital/Farmácia</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('roupa', this)">Roupas</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('acessorio', this)">Acessórios</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('padaria', this)">Padaria</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('floricultura', this)">Floricultura</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('ferreiro', this)">Ferreiro</button>
                            <button class="shop-cat-btn" onclick="filtrarLojaPorTipo('biblioteca', this)">Biblioteca</button>
                        </div>
                    </div>
                    <h3>Itens à Venda</h3>
                    <div class="bucket-grid" id="loja-itens-grid"><p>Carregando...</p></div>
                </div>

                <div id="inventario" class="tab-content">
                    <h2>Meu Inventário</h2>
                    <div class="bucket-grid" id="inventario-grid"><p>Carregando itens...</p></div>
                </div>

                <div id="personagens" class="tab-content"><h2>Diretório de Ninjas</h2><div class="bucket-grid" id="directory-grid"><p>Carregando...</p></div></div>
                <div id="missoes" class="tab-content"><h2>Quadro de Missões</h2><div class="bucket-grid" id="missoes-grid"><p>Carregando...</p></div></div>
                <div id="rankings" class="tab-content"><h2>Rankings Globais</h2><div class="rankings-wrapper" id="ranking-container"><p>Carregando Rankings...</p></div></div>
                <div id="admin-panel" class="tab-content"><h2>Painel Kage</h2><div class="bucket-grid" id="admin-missoes-grid"><p>Carregando...</p></div></div>
                
                <div id="dashboard" class="tab-content">
                    <h2>Estatísticas do Ninja</h2>
                    <div class="level-container">
                        <div class="level-info"><span id="level-display">Nível 1</span><span id="xp-text-display">0 / 500 XP</span></div>
                        <div class="xp-bar-bg"><div class="xp-bar-fill" id="xp-bar"></div><div class="xp-text">Progresso</div></div>
                    </div>
                    
                    <div class="powers-wrapper">
                        <div class="elementos-container" id="dash-elementos" style="display:none;"></div>
                        <div class="elementos-container" id="dash-kekkei" style="display:none;"></div>
                    </div>

                    <div class="profile-stats-grid">
                        <div class="stats-divider">Geral</div>
                        <div class="stat-card"><div class="stat-value" id="dash-nivel">1</div><div class="stat-label">Nível</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-cargo">Genin</div><div class="stat-label">Cargo</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-ryos">0</div><div class="stat-label">Ryos</div></div>
                        <div class="stats-divider">Batalha</div>
                        <div class="stat-card"><div class="stat-value" id="dash-wins">0</div><div class="stat-label">Vitórias</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-draws">0</div><div class="stat-label">Empates</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-loses">0</div><div class="stat-label">Derrotas</div></div>
                        <div class="stats-divider">Inventário</div>
                        <div class="stat-card"><div class="stat-value" id="dash-jutsus">0</div><div class="stat-label">Jutsus</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-tools">0</div><div class="stat-label">Ferramentas</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-items">0</div><div class="stat-label">Itens</div></div>
                        <div class="stats-divider">Vitalidade</div>
                        <div class="stat-card"><div class="stat-value" id="dash-vida">100</div><div class="stat-label">Vida</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-sanidade">100</div><div class="stat-label">Sanidade</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-chakra">100</div><div class="stat-label">Chakra</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-stamina">100</div><div class="stat-label">Stamina</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-controle">Baixo</div><div class="stat-label">Controle Chakra</div></div>
                        <div class="stats-divider">Atributos</div>
                        <div class="stat-card"><div class="stat-value" id="dash-forca">10</div><div class="stat-label">Força</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-defesa">10</div><div class="stat-label">Defesa</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-constituicao">10</div><div class="stat-label">Constituição</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-destreza">10</div><div class="stat-label">Destreza</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-intelecto">10</div><div class="stat-label">Intelecto</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-agilidade">10</div><div class="stat-label">Agilidade</div></div>
                        <div class="stat-card"><div class="stat-value" id="dash-velocidade">10</div><div class="stat-label">Velocidade</div></div>
                    </div>
                </div>
                
                <div id="historia" class="tab-content">
                    <div class="historia-container">
                        <div class="historia-img-container">
                            <img id="historia-display-img" src="https://img.freepik.com/vetores-gratis/fundo-de-paisagem-de-anime-de-design-plano_23-2149275367.jpg">
                            <button class="btn-edit-historia" onclick="window.editarHistoria()"><i class="fa-solid fa-pen"></i> Editar História</button>
                        </div>
                        <hr class="historia-divider">
                        <div class="historia-text-content" id="historia-display-text">A história do seu ninja aparecerá aqui.</div>
                    </div>
                </div>

                <div id="frases" class="tab-content">
                    <h2>Frases Marcantes</h2>
                    <div class="frase-input-area">
                        <input type="text" id="novaFraseInput" placeholder="Digite uma frase icônica...">
                        <button class="btn-post" onclick="window.adicionarFrase()">Adicionar</button>
                    </div>
                    <div class="frases-list" id="frases-list-container"><p style="color:#777; text-align:center;">Carregando frases...</p></div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay-comment" id="jutsuModal" style="z-index: 2001;">
        <div class="modal-content-card">
            <span class="close-modal" onclick="fecharJutsuModal()" style="color: #333; top: 10px; right: 15px;">&times;</span>
            <img id="jutsu-img-modal" src="" class="jutsu-modal-img">
            <h2 id="jutsu-name-modal" style="color:var(--primary-color);"></h2>
            <div id="jutsu-rank-modal" class="jutsu-modal-rank"></div>
            <div id="jutsu-stats-row" class="jutsu-stats-row"></div>
            <p id="jutsu-desc-modal" style="margin-top:10px;"></p>
            <div id="jutsu-price-modal" class="jutsu-modal-price"></div>
        </div>
    </div>
    
    <div class="modal-overlay-comment" id="toolModal" style="z-index: 2001;">
        <div class="modal-content-card" style="border-color: #555;">
            <span class="close-modal" onclick="fecharToolModal()" style="color: #333; top: 10px; right: 15px;">&times;</span>
            <img id="tool-img-modal" src="" class="jutsu-modal-img" style="border-color:#555;">
            <h2 id="tool-name-modal" style="color: #333;"></h2>
            <div id="tool-rank-modal" class="jutsu-modal-rank" style="background-color: #555;"></div>
            <p id="tool-desc-modal" style="margin-top:10px;"></p>
            <div id="tool-price-modal" class="jutsu-modal-price" style="border-color:#555; color:#555;"></div>
        </div>
    </div>

    <div class="modal-overlay-comment" id="itemModal" style="z-index: 2001;">
        <div class="modal-content-card" style="border-color: #2ecc71;">
            <span class="close-modal" onclick="fecharItemModal()" style="color: #333; top: 10px; right: 15px;">&times;</span>
            <img id="item-img-modal" src="" class="jutsu-modal-img" style="border-color:#2ecc71;">
            <h2 id="item-name-modal" style="color: #333;"></h2>
            <div id="item-rank-modal" class="jutsu-modal-rank" style="background-color: #2ecc71;"></div>
            <p id="item-desc-modal" style="margin-top:10px;"></p>
            <div id="item-price-modal" class="jutsu-modal-price" style="border-color:#2ecc71; color:#2ecc71;"></div>
        </div>
    </div>

    <div class="modal-overlay-comment" id="missaoModal" style="z-index: 2001;">
        <div class="modal-content-card" style="border-color: #e6b800; max-width: 500px;">
            <span class="close-modal" onclick="fecharMissaoModal()" style="color: #333; top: 10px; right: 15px;">&times;</span>
            <img id="missao-img-modal" src="" class="jutsu-modal-img" style="border-color:#e6b800; height: 150px;">
            <h2 id="missao-name-modal" style="color: #e6b800;"></h2>
            <div style="text-align: left; margin-bottom: 20px; max-height: 200px; overflow-y: auto; padding-right: 5px;">
                <p id="missao-desc-modal" style="color: #555; line-height: 1.6;"></p>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #e6b800; padding-top: 15px;">
                <div style="font-weight: bold; color: #2ecc71;">XP: <span id="missao-xp-modal">0</span> | Ryos: <span id="missao-reward-modal"></span></div>
                <div id="missao-actions-modal"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay-comment" id="profileModal" style="z-index: 2002;">
        <div class="modal-content-profile">
            <span class="close-modal" onclick="fecharProfileModal()" style="color: white; top: 15px; right: 15px;">&times;</span>
            <div class="profile-header"><div class="profile-avatar-large"><img src="" id="profile-modal-img"></div><h2 id="profile-modal-name" style="color:white;"></h2><p id="profile-modal-char" style="opacity:0.9;"></p></div>
            <div class="profile-body">
                <div class="powers-wrapper">
                    <div class="elementos-container" id="profile-elementos-container" style="display:none;"></div>
                    <div class="elementos-container" id="profile-kekkei-container" style="display:none;"></div>
                </div>
                <div class="profile-section-title">Estatísticas</div>
                <div class="profile-stats-grid" id="other-profile-stats"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay-comment" id="commentModal"><span class="close-modal" onclick="closeModal()">&times;</span><div class="modal-content-comment"><div class="modal-left" id="modalPostContent"></div><div class="modal-right"><div style="padding: 15px; border-bottom: 1px solid #eee;">Comentários</div><div class="comments-list" id="commentsList"></div><div class="comment-input-area"><input type="text" id="newCommentText" placeholder="Comentar..."><button onclick="submitComment()" style="border:none; background:none; color:var(--primary-color); font-weight:bold;">Enviar</button></div></div></div></div>
    <div class="modal-overlay-comment" id="editProfileModal" style="z-index: 2003;"><div class="modal-content-card"><span class="close-modal" onclick="closeEditProfileModal()" style="color: #333; top: 10px; right: 15px;">&times;</span><h3>Editar Perfil</h3><img id="edit-avatar-preview" src="" style="width:80px; height:80px; border-radius:50%; margin:10px auto; display:block;"><label for="edit-avatar-input" class="btn-post" style="display:block; width: fit-content; margin: 10px auto;">Escolher Foto</label><input type="file" id="edit-avatar-input" hidden accept="image/*" onchange="handleAvatarPreview(event)"><input type="text" id="edit-name-input" class="edit-input" placeholder="Nome do Personagem"><input type="text" id="edit-nick-input" class="edit-input" placeholder="Apelido"><button class="btn-post" onclick="salvarPerfil()" style="width: 100%;">Salvar</button></div></div>
    <div class="modal-overlay-comment" id="changePasswordModal" style="z-index: 2004;"><div class="modal-content-card"><span class="close-modal" onclick="closeChangePasswordModal()" style="color: #333; top: 10px; right: 15px;">&times;</span><h3>Alterar Senha</h3><input type="password" id="new-password" class="edit-input" placeholder="Nova Senha" style="margin-top:20px;"><button class="btn-post" onclick="salvarNovaSenha()" style="width: 100%;">Atualizar Senha</button></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, updatePassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, updateDoc, arrayUnion, arrayRemove, deleteDoc, increment, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyC3HOor32_p5Z-iADm0VgZ279rt1kj8ICg", authDomain: "rpg-naruto-5150a.firebaseapp.com", projectId: "rpg-naruto-5150a", storageBucket: "rpg-naruto-5150a.firebasestorage.app", messagingSenderId: "1007094335306", appId: "1:1007094335306:web:ac96fa96f9494f90fd63b3" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserData = null;
        let currentImageBase64 = null;
        let currentOpenPostId = null;
        let newAvatarBase64 = null;
        let globalXpTable = [];
        let vilaAtual = "Konoha";
        let lojaAtual = "geral";
        let globalItensMap = {}; // Cache para itens e ferramentas para o inventário

        // IMAGENS DOS ELEMENTOS
        const ELEMENTOS_ICONS = {
            "fogo": "https://pm1.aminoapps.com/6268/f93aa3930c07f92db411cc1e30bb510a3ceed1e6_hq.jpg",
            "agua": "data:image/jpeg;base64,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",
            "vento": "https://nrpgshinobi-konohagakure.weebly.com/uploads/1/6/0/4/16044106/819689103.png?193",
            "terra": "https://pm1.aminoapps.com/6532/d7006f61a97b53560516028523bf3f6e8e68ba69_hq.jpg",
            "raio": "data:image/jpeg;base64,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",
            "yin": "https://static.wikia.nocookie.net/naruto/images/d/de/Nature_Icon_Yin.svg/revision/latest/scale-to-width-down/200?cb=20100916093714",
            "yang": "https://static.wikia.nocookie.net/naruto/images/6/64/Nature_Icon_Yang.svg/revision/latest/scale-to-width-down/200?cb=20100916093715"// Placeholder
        };
        
        // IMAGENS DAS KEKKEI GENKAI (Preencha com seus links)
        const KEKKEI_ICONS = {
            "sharingan": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQsaFL3vRwLEqONbFnsr_tskXDVuf9C7F03HQ&s",
            "byakugan": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR8dibOxYWvh_iAG7J4BJ6u1ziT2vSb0PpWdg&s",
            "mokuton": "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/e8ddc4da-23dd-4502-b65b-378c9cfe5efa/dfgf9nz-2e0b4300-7506-42a7-8a0a-a51889a1765b.png/v1/fill/w_1280,h_1280/mokuton_icon_by_jormxdos_dfgf9nz-fullview.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTI4MCIsInBhdGgiOiIvZi9lOGRkYzRkYS0yM2RkLTQ1MDItYjY1Yi0zNzhjOWNmZTVlZmEvZGZnZjluei0yZTBiNDMwMC03NTA2LTQyYTctOGEwYS1hNTE4ODlhMTc2NWIucG5nIiwid2lkdGgiOiI8PTEyODAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.vjoEnWKes_DCAKclnfYppjrBjFn2sAFnzInsUdg2Fis",
            "veia_ossea": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRsbqzRS3LkfOJ69ZZvImlM2938cP4HHL3EzQ&s"
        };

        const IMG_PADRAO = "https://img.freepik.com/vetores-gratis/ilustracao-de-pergaminho-ninja-desenhada-a-mao_23-2151159846.jpg";

        function calcularTempo(timestamp) {
            if (!timestamp) return "Desconhecido";
            let date;
            // BLINDAGEM DE DATA
            try {
                if (typeof timestamp.toDate === 'function') date = timestamp.toDate();
                else if (timestamp instanceof Date) date = timestamp;
                else date = new Date(timestamp);
                
                if (isNaN(date.getTime())) return "Data Inválida";

                const now = new Date();
                const diff = Math.floor((now - date) / 1000);
                if (diff < 60) return "Agora";
                if (diff < 3600) return `Há ${Math.floor(diff / 60)} min`;
                if (diff < 86400) return `Há ${Math.floor(diff / 3600)} h`;
                if (diff < 604800) return `Há ${Math.floor(diff / 86400)} dias`;
                return date.toLocaleDateString('pt-BR');
            } catch (e) { return "Erro Data"; }
        }

        window.toggleMobileMenu = () => { document.querySelector('.sidebar').classList.toggle('mobile-active'); document.querySelector('.sidebar-overlay').classList.toggle('active'); };
        const btnLogin = document.getElementById('btnLogin');
        if(btnLogin) btnLogin.addEventListener('click', () => { const e = document.getElementById('emailInput').value, s = document.getElementById('passwordInput').value; if(!e || !s) return alert("Preencha tudo!"); btnLogin.innerText = "Carregando..."; signInWithEmailAndPassword(auth, e, s).catch((err) => { btnLogin.innerText = "Entrar"; alert(err.message); }); });
        
        // ENTER LOGIN (CORRIGIDO)
        const passInput = document.getElementById('passwordInput');
        if (passInput) {
            passInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const btn = document.getElementById('btnLogin');
                    if (btn) btn.click();
                }
            });
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                if(user.email === "admin@rpgnaruto.com") document.getElementById('btn-admin-panel').style.display = 'flex';
                await carregarConfiguracoes();
                await carregarCacheItens();
                
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    currentUserData = docSnap.data();
                    if(!currentUserData.inventario) currentUserData.inventario = {}; 
                    atualizarInterface(currentUserData);
                    carregarTudo();
                } else {
                    const dadosPadrao = { nome: "Novo Ninja", ryos: 100, xp: 0, nivel: 1, email: user.email, meusJutsus: [], inventario: {}, statusMissoes: {}, elementos: [], kekkei_genkai: [] };
                    await setDoc(docRef, dadosPadrao);
                    currentUserData = dadosPadrao;
                    atualizarInterface(dadosPadrao);
                    carregarTudo();
                }
                
                // INICIALIZAÇÃO BLINDADA DO FEED
                setTimeout(() => {
                    try { window.renderFeed('all'); } catch(e) { console.log("Erro inicializar feed:", e); }
                }, 800); 
                
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-container').style.display = 'none';
            }
        });

        async function carregarConfiguracoes() { try { const s = await getDoc(doc(db, "game_config", "sistema_nivel")); if(s.exists()) globalXpTable = s.data().tabela_xp || []; } catch(e) {} }
        async function carregarCacheItens() {
            const s1 = await getDocs(collection(db, "itens")); s1.forEach(d => globalItensMap[d.id] = { ...d.data(), type: 'item' });
            const s2 = await getDocs(collection(db, "ferramentas")); s2.forEach(d => globalItensMap[d.id] = { ...d.data(), type: 'tool' });
        }

        function carregarTudo() {
            carregarLoja(); carregarMeusJutsus(currentUserData.meusJutsus);
            carregarLojaFerramentas(); 
            carregarLojaItens(); 
            carregarInventario(); 
            carregarMissoes(); carregarRankings(); carregarFrases(); 
            if(auth.currentUser.email === "admin@rpgnaruto.com") carregarPainelAdmin();
        }

        function formatarNum(v) { return Number(v||0).toLocaleString('pt-BR'); }

        function renderizarIcones(lista, containerId, mapaIcones, titulo) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = `<div class="elementos-title">${titulo}</div><div class="elementos-list"></div>`;
            const listDiv = container.querySelector('.elementos-list');
            
            if (!lista || lista.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            lista.forEach(elem => {
                const cleanElem = elem.trim().toLowerCase();
                const iconUrl = mapaIcones[cleanElem];
                if (iconUrl) {
                    const img = document.createElement('img');
                    img.src = iconUrl;
                    img.className = 'element-icon';
                    img.title = elem; 
                    listDiv.appendChild(img);
                }
            });
        }

        function atualizarInterface(dados) {
            document.querySelector('.user-info').innerText = dados.apelido || dados.nome || "Ninja";
            document.getElementById('ryos-text').innerText = formatarNum(dados.ryos);
            if(dados.avatar) document.getElementById('header-avatar').src = dados.avatar;
            if(dados.historiaTexto) document.getElementById('historia-display-text').innerText = dados.historiaTexto;
            if(dados.historiaImagem) document.getElementById('historia-display-img').src = dados.historiaImagem;

            const nivel = dados.nivel || 1, xpAtual = dados.xp || 0;
            const xpNecessario = globalXpTable[nivel] ? globalXpTable[nivel] : (nivel * 500); 
            const porcentagem = Math.min((xpAtual / xpNecessario) * 100, 100);
            document.getElementById('level-display').innerText = "Nível " + nivel;
            document.getElementById('xp-text-display').innerText = `${xpAtual} / ${xpNecessario} XP`;
            document.getElementById('xp-bar').style.width = porcentagem + "%";

            // RENDERIZAR ELEMENTOS E KEKKEI NO DASHBOARD
            renderizarIcones(dados.elementos || [], 'dash-elementos', ELEMENTOS_ICONS, 'Naturezas de Chakra');
            renderizarIcones(dados.kekkei_genkai || [], 'dash-kekkei', KEKKEI_ICONS, 'Kekkei Genkai');

            // Stats
            const set = (id, val) => { const el = document.getElementById(id); if(el) el.innerText = val; };
            set('dash-nivel', nivel); set('dash-cargo', dados.cargo||"Genin"); set('dash-ryos', formatarNum(dados.ryos));
            set('dash-jutsus', (dados.meusJutsus || []).length); 
            
            // Contagem Inventário
            let totalItems = 0, totalTools = 0;
            if(dados.inventario) {
                for(let id in dados.inventario) {
                   if(globalItensMap[id]) {
                       if(globalItensMap[id].type === 'tool') totalTools += dados.inventario[id];
                       else totalItems += dados.inventario[id];
                   }
                }
            }
            set('dash-tools', totalTools); set('dash-items', totalItems);

            set('dash-wins', dados.vitorias||0); set('dash-loses', dados.derrotas||0); set('dash-draws', dados.empates||0);
            set('dash-vida', dados.vida||100); set('dash-sanidade', dados.sanidade||100);
            set('dash-chakra', dados.chakra||100); set('dash-stamina', dados.stamina||100); set('dash-controle', dados.controle_chakra||"Baixo");
            set('dash-forca', dados.forca||10); set('dash-defesa', dados.defesa||10); set('dash-constituicao', dados.constituicao||10);
            set('dash-destreza', dados.destreza||10); set('dash-intelecto', dados.intelecto||10); set('dash-agilidade', dados.agilidade||10); set('dash-velocidade', dados.velocidade||10);
        }

        function comprimirImagem(file) { return new Promise((resolve, reject) => { const r = new FileReader(); r.readAsDataURL(file); r.onload = (e) => { const i = new Image(); i.src = e.target.result; i.onload = () => { const c = document.createElement('canvas'), MAX = 600; let w = i.width, h = i.height; if (w > MAX) { h *= MAX / w; w = MAX; } c.width = w; c.height = h; c.getContext('2d').drawImage(i, 0, 0, w, h); resolve(c.toDataURL('image/jpeg', 0.7)); }; }; r.onerror = reject; }); }

        window.showTab = (t) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            document.querySelectorAll('.top-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
            const btnTop = document.getElementById('nav-btn-'+t);
            const btnSide = document.getElementById('side-btn-'+t);
            if(btnTop) btnTop.classList.add('active');
            if(btnSide) btnSide.classList.add('active');
            if(t==='personagens') carregarPersonagens();
            if(t==='frases') carregarFrases();
            if(t==='inventario') carregarInventario();
            if(window.innerWidth <= 768) window.toggleMobileMenu();
        };

        window.toggleMenu = () => document.getElementById('user-menu').classList.toggle('show');
        window.fazerLogout = () => signOut(auth).then(() => location.reload());
        
        // --- FUNÇÕES DE PERFIL E SENHA ---
        window.openEditProfileModal = () => { document.getElementById('editProfileModal').style.display = 'flex'; document.getElementById('edit-name-input').value = currentUserData.nome || ""; document.getElementById('edit-nick-input').value = currentUserData.apelido || ""; document.getElementById('user-menu').classList.remove('show'); };
        window.closeEditProfileModal = () => document.getElementById('editProfileModal').style.display = 'none';
        window.handleAvatarPreview = async (e) => { if(e.target.files[0]) { newAvatarBase64 = await comprimirImagem(e.target.files[0]); document.getElementById('edit-avatar-preview').src = newAvatarBase64; } };
        window.salvarPerfil = async () => { const nome = document.getElementById('edit-name-input').value; const apelido = document.getElementById('edit-nick-input').value; const updates = { nome: nome, apelido: apelido, personagem: nome }; if(newAvatarBase64) updates.avatar = newAvatarBase64; await updateDoc(doc(db, "users", auth.currentUser.uid), updates); location.reload(); };
        window.openChangePasswordModal = () => { document.getElementById('changePasswordModal').style.display='flex'; document.getElementById('user-menu').classList.remove('show'); };
        window.closeChangePasswordModal = () => document.getElementById('changePasswordModal').style.display='none';
        window.salvarNovaSenha = async () => { const p = document.getElementById('new-password').value; if(!p || p.length < 6) return alert("Mínimo 6 caracteres"); try { await updatePassword(auth.currentUser, p); alert("Sucesso!"); closeChangePasswordModal(); } catch(e) { alert("Erro: " + e.message); } };

        // --- FILTROS LOJA ---
        window.atualizarFiltroVila = () => { vilaAtual = document.getElementById('shop-location').value; carregarLojaItens(); };
        window.filtrarLojaPorTipo = (t, b) => { lojaAtual = t; document.querySelectorAll('.shop-cat-btn').forEach(x => x.classList.remove('active')); b.classList.add('active'); carregarLojaItens(); };

        // --- RENDERIZADORES DE CARD ---
        function criarCard(containerId, dados, id, tipo, clickFn, qtd = null) {
            const c = document.getElementById(containerId); if(!c) return;
            const div = document.createElement('div'); div.className = 'card'; div.onclick = () => clickFn(id, dados);
            let sub = "", extra = "";
            if(tipo === 'jutsu') {
                sub = "Rank " + dados.rank;
                if(currentUserData.maestrias) extra = `<span class="maestria-display">Maestria: ${currentUserData.maestrias[id]||0}</span>`;
            } else if(tipo === 'ferramenta') sub = dados.dano || "Ferramenta";
            else sub = dados.efeito || "Item";
            
            if(qtd !== null) {
                // Se for inventário, adiciona o botão de MENOS
                extra += `<div class="inventory-controls"><span class="qtd-badge">x${qtd}</span><button class="btn-minus" onclick="consumirItem('${id}', '${dados.nome}'); event.stopPropagation();">-</button></div>`;
            }

            div.innerHTML = `<img src="${dados.imagem||IMG_PADRAO}" class="card-img-top"><h4>${dados.nome}</h4><small>${sub}</small>${extra}`;
            c.appendChild(div);
        }
        function criarCardLoja(containerId, dados, id, tipo, buyFn, clickFn) {
            const c = document.getElementById(containerId); if(!c) return;
            const div = document.createElement('div'); div.className = 'card'; div.onclick = (e) => { if(!e.target.classList.contains('buy-btn')) clickFn(id, dados); };
            let sub = "";
            if(tipo === 'jutsu') sub = "Rank " + dados.rank; else if(tipo === 'ferramenta') sub = dados.dano || "Ferramenta"; else sub = dados.efeito || "Item";
            div.innerHTML = `<img src="${dados.imagem||IMG_PADRAO}" class="card-img-top"><h4>${dados.nome}</h4><small>${sub}</small><p style="color:var(--primary-color); font-weight:bold;">${formatarNum(dados.preco)} Ryos</p><button class="buy-btn">Comprar</button>`;
            div.querySelector('.buy-btn').onclick = (e) => { e.stopPropagation(); buyFn(id, dados.preco, dados.nome); };
            c.appendChild(div);
        }

        // --- LOADERS ---
        async function carregarLoja() {
            const c = document.getElementById('loja-jutsus-grid'); if(!c) return; c.innerHTML = '';
            const m = currentUserData.meusJutsus || [];
            const snap = await getDocs(collection(db, "jutsus"));
            snap.forEach(d => { const i = d.data(); const p = i.restrito_a || []; if(p.length > 0 && !p.includes(currentUserData.nome)) return; if(!m.includes(d.id)) criarCardLoja('loja-jutsus-grid', i, d.id, 'jutsu', (id, p, n) => comprarJutsu(id, p, n), (id, i) => verDetalhesJutsu(id, i)); });
        }
        async function carregarMeusJutsus(l) {
            const c = document.getElementById('meus-jutsus-grid'); if(!c) return; c.innerHTML = '';
            if(!l || l.length === 0) { c.innerHTML = '<p>Vazio.</p>'; return; }
            for(const id of l) { const s = await getDoc(doc(db, "jutsus", id)); if(s.exists()) criarCard('meus-jutsus-grid', s.data(), id, 'jutsu', (id, i) => verDetalhesJutsu(id, i)); }
        }
        async function carregarLojaFerramentas() {
            const c = document.getElementById('loja-ferramentas-grid'); if(!c) return; c.innerHTML = '';
            const snap = await getDocs(collection(db, "ferramentas"));
            snap.forEach(d => { criarCardLoja('loja-ferramentas-grid', d.data(), d.id, 'ferramenta', (id, p, n) => comprarFerramenta(id, p, n), (id, i) => verDetalhesFerramenta(id, i)); });
        }
        async function carregarLojaItens() {
            const c = document.getElementById('loja-itens-grid'); if(!c) return; c.innerHTML = '';
            const snap = await getDocs(collection(db, "itens"));
            snap.forEach(d => {
                const i = d.data();
                // Lógica para Array ou String na vila
                let vilaOk = false;
                if(!i.vila || i.vila === 'Global') vilaOk = true;
                else if(Array.isArray(i.vila)) { if(i.vila.includes(vilaAtual) || i.vila.includes('Global')) vilaOk = true; }
                else if(i.vila === vilaAtual) vilaOk = true;

                // CORREÇÃO: Filtro estrito para 'geral'
                if (i.tipo !== lojaAtual) return;
                
                if (!vilaOk) return;

                criarCardLoja('loja-itens-grid', i, d.id, 'item', (id, p, n) => comprarItem(id, p, n), (id, i) => verDetalhesItem(id, i));
            });
        }

        // --- INVENTÁRIO (NOVO) ---
        async function carregarInventario() {
            const c = document.getElementById('inventario-grid'); if(!c) return; c.innerHTML = '';
            const inv = currentUserData.inventario || {};
            const keys = Object.keys(inv);
            
            // FILTRA APENAS ITENS COM QTD > 0
            const validKeys = keys.filter(k => inv[k] > 0);
            
            if(validKeys.length === 0) { c.innerHTML = '<p>Mochila vazia.</p>'; return; }
            
            validKeys.forEach(id => {
                const qtd = inv[id];
                const info = globalItensMap[id];
                if(info) {
                    criarCard('inventario-grid', info, id, info.type, (id, d) => {
                       if(info.type === 'tool') verDetalhesFerramenta(id, d);
                       else verDetalhesItem(id, d);
                    }, qtd);
                }
            });
        }

        // --- CONSUMO ---
        window.consumirItem = async (id, nome) => {
             if(!confirm(`Usar/Descartar 1x ${nome}?`)) return;
             // Decrementa 1
             await updateDoc(doc(db, "users", auth.currentUser.uid), {
                 [`inventario.${id}`]: increment(-1)
             });
             reloadData();
        };

        // --- COMPRA LOGIC (UPDATED FOR INVENTORY) ---
        window.comprarJutsu = async (id, p, n) => {
            if(!confirm(`Comprar ${n}?`)) return; if(currentUserData.ryos < p) return alert("Sem Ryos!");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { ryos: increment(-p), meusJutsus: arrayUnion(id), [`maestrias.${id}`]: 0 });
            alert("Comprado!"); reloadData();
        };
        window.comprarFerramenta = async (id, p, n) => {
            if(!confirm(`Comprar ${n}?`)) return; if(currentUserData.ryos < p) return alert("Sem Ryos!");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { ryos: increment(-p), [`inventario.${id}`]: increment(1) });
            alert("Comprado!"); reloadData();
        };
        window.comprarItem = async (id, p, n) => {
            if(!confirm(`Comprar ${n}?`)) return; if(currentUserData.ryos < p) return alert("Sem Ryos!");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { ryos: increment(-p), [`inventario.${id}`]: increment(1) });
            alert("Comprado!"); reloadData();
        };
        async function reloadData() {
            const s = await getDoc(doc(db, "users", auth.currentUser.uid)); currentUserData = s.data(); atualizarInterface(currentUserData); carregarTudo();
        }

        // --- MODAL DETAILS ---
        function abrirModal(t, d) {
            let p = t; document.getElementById(p+'-name-modal').innerText = d.nome; document.getElementById(p+'-desc-modal').innerText = d.descricao||""; document.getElementById(p+'-price-modal').innerText = "Valor: "+formatarNum(d.preco)+" Ryos";
            const i = document.getElementById(p+'-img-modal'); i.src = d.imagem||IMG_PADRAO;
            if(t==='jutsu'){
                document.getElementById(p+'-rank-modal').innerText = "Rank "+d.rank;
                let h=""; if(d.dano) h+=`<span class="jutsu-stat-tag tag-dano">${d.dano}</span>`; if(d.chakra) h+=`<span class="jutsu-stat-tag tag-chakra">Chakra: ${d.chakra}</span>`; if(d.stamina) h+=`<span class="jutsu-stat-tag tag-stamina">Stamina: ${d.stamina}</span>`; if(d.bonus) h+=`<span class="jutsu-stat-tag tag-buff">${d.bonus}</span>`;
                document.getElementById('jutsu-stats-row').innerHTML = h;
            }
            if(t==='tool') document.getElementById(p+'-rank-modal').innerText = d.dano||"Ferramenta";
            if(t==='item') document.getElementById(p+'-rank-modal').innerText = d.efeito||"Item";
            document.getElementById(t+'Modal').style.display='flex';
        }
        window.verDetalhesJutsu = (i,d) => abrirModal('jutsu',d); window.verDetalhesFerramenta = (i,d) => abrirModal('tool',d); window.verDetalhesItem = (i,d) => abrirModal('item',d);
        window.fecharJutsuModal = () => document.getElementById('jutsuModal').style.display='none';
        window.fecharToolModal = () => document.getElementById('toolModal').style.display='none';
        window.fecharItemModal = () => document.getElementById('itemModal').style.display='none';

        // --- FEED (BLINDADO) ---
        window.handleImageUpload = async (e) => { if(e.target.files[0]) { try { currentImageBase64 = await comprimirImagem(e.target.files[0]); document.getElementById('preview-image').src = currentImageBase64; document.getElementById('preview-container').style.display='block'; } catch(e){alert("Erro imagem");} } };
        window.removeImage = () => { document.getElementById('imageInput').value=''; currentImageBase64=null; document.getElementById('preview-container').style.display='none'; };
        window.publicarPost = async () => {
            const t = document.getElementById('postInput').value; if(!t.trim() && !currentImageBase64) return alert("Escreva algo!");
            const btn = document.querySelector('.btn-post'); btn.innerText="..."; btn.disabled=true;
            try { await addDoc(collection(db, "posts"), { uid: auth.currentUser.uid, autor: currentUserData.apelido || "Ninja", autorAvatar: currentUserData.avatar, conteudo: t, imagem: currentImageBase64, data: serverTimestamp(), likes: [], savedBy: [], comments: [] }); document.getElementById('postInput').value=''; removeImage(); } catch(e) { alert("Erro."); } finally { btn.innerText="Publicar"; btn.disabled=false; }
        };
        window.renderFeed = (f) => {
            const c = document.getElementById('feed-container'); if(!c) return;
            
            try {
                onSnapshot(query(collection(db, "posts"), orderBy("data", "desc")), (s) => {
                    c.innerHTML = ''; 
                    if(s.empty) { c.innerHTML = '<p style="text-align:center;">Nada aqui.</p>'; return; }
                    
                    s.forEach(d => {
                        // BLINDAGEM DE ERROS
                        try {
                            const p = d.data(); 
                            const id = d.id;
                            
                            // Garante que as listas existam
                            const likes = p.likes || [];
                            const savedBy = p.savedBy || [];
                            const comments = p.comments || [];
                            
                            if(f==='saved' && !savedBy.includes(auth.currentUser.uid)) return;
                            
                            const isOwner = p.uid === auth.currentUser.uid;
                            const isLiked = likes.includes(auth.currentUser.uid);
                            const isSaved = savedBy.includes(auth.currentUser.uid);

                            const menu = isOwner ? `<div class="post-menu-container"><div class="post-options-btn" onclick="this.nextElementSibling.classList.toggle('active')">...</div><div class="post-dropdown"><div class="dropdown-item danger" onclick="deletarPost('${id}')">Excluir</div></div></div>` : '';
                            
                            const div = document.createElement('div'); div.className='post';
                            div.innerHTML = `
                                <div class="post-header">
                                    <div class="user-avatar-post"><img src="${p.autorAvatar||IMG_PADRAO}"></div>
                                    <div class="post-info"><span class="post-author">${p.autor}</span><span class="post-time">${calcularTempo(p.data)}</span></div>
                                    ${menu}
                                </div>
                                <div class="post-content">${p.conteudo}</div>
                                ${p.imagem ? `<img src="${p.imagem}" class="post-image" onclick="verPost('${id}')">` : ''}
                                <div class="post-actions">
                                    <button class="action-btn ${isLiked?'liked':''}" onclick="toggleLike('${id}')">
                                        <i class="${isLiked?'fa-solid':'fa-regular'} fa-heart"></i> ${likes.length}
                                    </button>
                                    <button class="action-btn" onclick="verPost('${id}')">
                                        <i class="fa-regular fa-comment"></i> ${comments.length}
                                    </button>
                                    <button class="action-btn ${isSaved?'saved':''}" onclick="toggleSave('${id}')" style="margin-left:auto;">
                                        <i class="${isSaved?'fa-solid':'fa-regular'} fa-bookmark"></i>
                                    </button>
                                </div>`;
                            c.appendChild(div);
                        } catch (innerError) {
                            console.warn("Erro ao renderizar post específico:", innerError);
                        }
                    });
                }, (error) => { console.error("Erro Feed Snapshot:", error); c.innerHTML = "<p>Erro de conexão com o feed.</p>"; });
            } catch (err) { console.error("Erro geral Feed:", err); }
        };

        window.deletarPost = async (id) => { if(confirm("Apagar?")) await deleteDoc(doc(db, "posts", id)); };
        window.toggleLike = async (id) => { const r=doc(db,"posts",id), s=await getDoc(r), l=s.data().likes || []; if(l.includes(auth.currentUser.uid)) await updateDoc(r,{likes:arrayRemove(auth.currentUser.uid)}); else await updateDoc(r,{likes:arrayUnion(auth.currentUser.uid)}); };
        window.toggleSave = async (id) => { const r=doc(db,"posts",id), s=await getDoc(r), l=s.data().savedBy || []; if(l.includes(auth.currentUser.uid)) await updateDoc(r,{savedBy:arrayRemove(auth.currentUser.uid)}); else await updateDoc(r,{savedBy:arrayUnion(auth.currentUser.uid)}); };
        
        window.verPost = async (id) => { 
            currentOpenPostId = id; 
            const s = await getDoc(doc(db, "posts", id));
            const p = s.data(); 
            document.getElementById('modalPostContent').innerHTML = p.imagem ? `<img src="${p.imagem}" style="width:100%;height:100%;object-fit:contain;">` : `<div style="padding:20px;">${p.conteudo}</div>`; 
            document.getElementById('commentsList').innerHTML = (p.comments || []).map(c=>`<div><b>${c.autor}</b>: ${c.texto}</div>`).join(''); 
            document.getElementById('commentModal').style.display='flex'; 
        };
        
        window.submitComment = async () => { const t = document.getElementById('newCommentText').value; if(!t) return; await updateDoc(doc(db, "posts", currentOpenPostId), { comments: arrayUnion({ autor: currentUserData.nome, texto: t }) }); document.getElementById('newCommentText').value = ""; verPost(currentOpenPostId); };
        window.closeModal = () => document.getElementById('commentModal').style.display = 'none';

        // --- CARREGADORES SECUNDÁRIOS ---
        async function carregarPersonagens() { const c = document.getElementById('directory-grid'); if(!c) return; const s = await getDocs(collection(db, "users")); c.innerHTML = ''; s.forEach(d => { const u = d.data(); const k = document.createElement('div'); k.className = 'card'; k.onclick = () => window.verPerfil(d.id); k.innerHTML = `<div style="width:60px; height:60px; border-radius:50%; overflow:hidden; margin:0 auto 10px;"><img src="${u.avatar||IMG_PADRAO}" style="width:100%; height:100%; object-fit:cover;"></div><h4>${u.nome}</h4><p>${u.apelido||""}</p>`; c.appendChild(k); }); }
        
        // --- FUNÇÃO VER PERFIL DE OUTROS CORRIGIDA ---
        window.verPerfil = async (uid) => {
            const s = await getDoc(doc(db, "users", uid));
            if(s.exists()) {
                const u = s.data();
                document.getElementById('profile-modal-name').innerText = u.nome;
                document.getElementById('profile-modal-char').innerText = u.apelido || "";
                document.getElementById('profile-modal-img').src = u.avatar||IMG_PADRAO;
                
                // RENDERIZAR ELEMENTOS NO PERFIL
                renderizarIcones(u.elementos || [], 'profile-elementos-container', ELEMENTOS_ICONS, 'Naturezas de Chakra');
                renderizarIcones(u.kekkei_genkai || [], 'profile-kekkei-container', KEKKEI_ICONS, 'Kekkei Genkai');
                
                // Injetar HTML de stats no modal
                const statsContainer = document.getElementById('other-profile-stats');
                statsContainer.innerHTML = `
                    <div class="stats-divider">Geral</div>
                    <div class="stat-card"><div class="stat-value">${u.nivel||1}</div><div class="stat-label">Nível</div></div>
                    <div class="stat-card"><div class="stat-value">${u.cargo||'Genin'}</div><div class="stat-label">Cargo</div></div>
                    <div class="stat-card"><div class="stat-value">${formatarNum(u.ryos)}</div><div class="stat-label">Ryos</div></div>
                    
                    <div class="stats-divider">Batalha</div>
                    <div class="stat-card"><div class="stat-value">${u.vitorias||0}</div><div class="stat-label">Vitórias</div></div>
                    <div class="stat-card"><div class="stat-value">${u.loses||0}</div><div class="stat-label">Derrotas</div></div>

                    <div class="stats-divider">Inventário</div>
                    <div class="stat-card"><div class="stat-value">${(u.meusJutsus||[]).length}</div><div class="stat-label">Jutsus</div></div>
                    
                    <div class="stats-divider">Vitalidade</div>
                    <div class="stat-card"><div class="stat-value">${u.vida||100}</div><div class="stat-label">Vida</div></div>
                    <div class="stat-card"><div class="stat-value">${u.chakra||100}</div><div class="stat-label">Chakra</div></div>
                    <div class="stat-card"><div class="stat-value">${u.stamina||100}</div><div class="stat-label">Stamina</div></div>
                    <div class="stat-card"><div class="stat-value">${u.controle_chakra||"Baixo"}</div><div class="stat-label">Controle</div></div>

                    <div class="stats-divider">Atributos</div>
                    <div class="stat-card"><div class="stat-value">${u.forca||10}</div><div class="stat-label">Força</div></div>
                    <div class="stat-card"><div class="stat-value">${u.defesa||10}</div><div class="stat-label">Defesa</div></div>
                    <div class="stat-card"><div class="stat-value">${u.agilidade||10}</div><div class="stat-label">Agilidade</div></div>
                    <div class="stat-card"><div class="stat-value">${u.velocidade||10}</div><div class="stat-label">Velocidade</div></div>
                    <div class="stat-card"><div class="stat-value">${u.intelecto||10}</div><div class="stat-label">Intelecto</div></div>
                `;

                document.getElementById('profileModal').style.display = 'flex';
            }
        };
        window.fecharProfileModal = () => document.getElementById('profileModal').style.display = 'none';
        
        async function carregarMissoes() { const c = document.getElementById('missoes-grid'); if(!c) return; const m = currentUserData.statusMissoes || {}; const s = await getDocs(collection(db, "missoes")); c.innerHTML = ''; s.forEach(d => { const i = d.data(), st = m[d.id] || 'neutro'; const k = document.createElement('div'); k.className = 'card jutsu-card-click'; k.onclick = () => verDetalhesMissao(d.id, i, st); k.innerHTML=`<h4>${i.titulo}</h4><p style="font-size:0.9rem; color:${st==='em_andamento'?'orange':st==='aprovado'?'green':'#777'}; font-weight:bold;">${st==='neutro'?'Disponível':st}</p><small style="color:var(--primary-color)">${i.xp||0} XP | ${formatarNum(i.recompensa)} Ryos</small>`; c.appendChild(k); }); }
        window.verDetalhesMissao = (id, d, st) => { document.getElementById('missao-name-modal').innerText = d.titulo; document.getElementById('missao-desc-modal').innerText = d.descricao; document.getElementById('missao-reward-modal').innerText = formatarNum(d.recompensa); document.getElementById('missao-xp-modal').innerText = d.xp||0; document.getElementById('missao-img-modal').src = d.imagem||IMG_PADRAO; const a = document.getElementById('missao-actions-modal'); a.innerHTML = ''; if(st==='neutro') a.innerHTML = `<button class="mission-btn-start" onclick="iniciarMissao('${id}')">Aceitar</button>`; else if(st==='aprovado') a.innerHTML = `<button class="mission-btn-collect" onclick="coletarRecompensa('${id}',${d.recompensa},${d.xp||0})">Receber</button>`; document.getElementById('missaoModal').style.display='flex'; };
        window.fecharMissaoModal = () => document.getElementById('missaoModal').style.display='none';
        
        window.iniciarMissao = async (id) => { await updateDoc(doc(db, "users", auth.currentUser.uid), { [`statusMissoes.${id}`]: 'em_andamento' }); alert("Iniciada!"); reloadData(); };
        window.coletarRecompensa = async (id, r, x) => { const u = currentUserData, nr = (u.ryos||0)+r, nx = (u.xp||0)+x; let lvl = u.nivel||1, req = globalXpTable[lvl] || (lvl*500); let upou = false; while(nx >= req) { nx -= req; lvl++; req = globalXpTable[lvl] || (lvl*500); upou = true; } await updateDoc(doc(db, "users", auth.currentUser.uid), { ryos: nr, xp: nx, nivel: lvl, [`statusMissoes.${id}`]: 'concluido' }); if(upou) alert("Level Up!"); else alert("Coletado!"); reloadData(); };

        window.carregarRankings = async () => { const c = document.getElementById('ranking-container'); if(!c) return; const s = await getDocs(collection(db, "users")); let l=[]; s.forEach(d=>l.push(d.data())); c.innerHTML=''; renderRank(c,"Ryos",l,'ryos'); renderRank(c,"Nível",l,'nivel'); };
        function renderRank(c,t,l,f) { const s=[...l].sort((a,b)=>(b[f]||0)-(a[f]||0)).slice(0,5); let h=`<div class="ranking-col"><h3>${t}</h3><table class="ranking-table">`; s.forEach((u,i)=>h+=`<tr><td>${i+1}. ${u.nome}</td><td>${formatarNum(u[f])}</td></tr>`); h+='</table></div>'; c.innerHTML+=h; }

        window.editarHistoria = async () => { const n=prompt("Texto:",currentUserData.historiaTexto||""); if(n){ const i=prompt("Imagem:",currentUserData.historiaImagem||""); updateDoc(doc(db,"users",auth.currentUser.uid),{historiaTexto:n,historiaImagem:i}).then(reloadData); } }
        async function carregarFrases() { const c = document.getElementById('frases-list-container'); onSnapshot(query(collection(db, "frases"), orderBy("data", "desc")), (s) => { c.innerHTML=''; s.forEach(d=>{ const f=d.data(); const k=document.createElement('div'); k.className='frase-item'; const menu = f.uid === auth.currentUser.uid ? `<div class="options-menu-container"><div class="options-btn" onclick="toggleFraseMenu(this); event.stopPropagation();">...</div><div class="options-dropdown"><div class="options-item" onclick="editarFrase('${d.id}','${f.texto}');event.stopPropagation()">Editar</div><div class="options-item danger" onclick="deletarFrase('${d.id}');event.stopPropagation()">Excluir</div></div></div>` : ''; k.onclick=()=>copiarFrase(f.texto); k.innerHTML=`<div class="frase-content">"${f.texto}"</div><div class="frase-author">- ${f.autor}</div>${menu}`; c.appendChild(k); }); }); }
        window.toggleFraseMenu = (el) => { const dropdown = el.nextElementSibling; document.querySelectorAll('.options-dropdown').forEach(d => { if(d !== dropdown) d.classList.remove('active'); }); dropdown.classList.toggle('active'); };
        window.adicionarFrase = async () => { const t=document.getElementById('novaFraseInput').value; if(t) await addDoc(collection(db,"frases"),{texto:t,autor:currentUserData.nome,uid:auth.currentUser.uid,data:serverTimestamp()}); document.getElementById('novaFraseInput').value=''; }
        window.editarFrase = async (id, oldText) => { const n = prompt("Editar:", oldText); if(n) await updateDoc(doc(db, "frases", id), { texto: n }); };
        window.deletarFrase = async (id) => { if(confirm("Excluir?")) await deleteDoc(doc(db, "frases", id)); };
        window.copiarFrase = (t) => { navigator.clipboard.writeText(t).then(() => { const f=document.getElementById('copyFeedback'); f.style.display='block'; setTimeout(()=>f.style.display='none',2000); }); };

        async function carregarPainelAdmin() { const c = document.getElementById('admin-missoes-grid'); c.innerHTML='Carregando...'; const s = await getDocs(collection(db, "users")); c.innerHTML=''; s.forEach(u=>{ const d=u.data(), m=d.statusMissoes||{}; for(const [mid,st] of Object.entries(m)){ if(st==='em_andamento'){ const k=document.createElement('div'); k.className='card'; k.innerHTML=`<h4>${d.nome}</h4><p>${mid}</p><button class="mission-btn-collect" onclick="aprovarMissao('${u.id}','${mid}')">Aprovar</button>`; c.appendChild(k); } } }); }
        window.aprovarMissao = async (uid, mid) => { if(confirm("Aprovar?")) await updateDoc(doc(db, "users", uid), { [`statusMissoes.${mid}`]: 'aprovado' }); alert("Feito!"); reloadData(); };

    </script>
</body>
</html>


